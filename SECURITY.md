# Security â€” VL-RAG-Graph-RLM

> **Local Security Orchestration** â€” No CI required. Compliant with OWASP Agentic Security Top 10 (2026).

## Overview

This codebase uses **ainish-coder** for local security orchestration. Security is enforced via git hooks and local scripts â€” no GitHub Actions, no remote dependencies, no external services required.

## What's Deployed

```
.ainish/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ sanitize.py          # Pre-commit: auto-sanitizes secrets in staged files
â”‚   â””â”€â”€ scan_secrets.sh      # Pre-push: scans entire repo for secrets before push
â”œâ”€â”€ .git/hooks/
â”‚   â”œâ”€â”€ pre-commit           # Runs sanitize.py on every commit
â”‚   â””â”€â”€ pre-push             # Runs scan_secrets.sh before every push
â””â”€â”€ SECURITY_REPORT.md       # Generated by scan_secrets.sh (gitignored)
```

## How It Works

### Pre-Commit Hook (sanitize.py)

**When:** Every time you run `git commit`

**What it does:**
1. Scans staged files for secrets and sensitive patterns
2. Auto-sanitizes detected secrets (replaces with placeholders)
3. Prevents accidental commits of API keys, tokens, local paths

**Example:**
```python
# Before commit:
export SAMBANOVA_API_KEY=3f8a9b2c...

# After sanitize.py:
export SAMBANOVA_API_KEY=YOUR_SAMBANOVA_API_KEY_HERE
```

**Patterns sanitized:** 50+ secret types including:
- API keys (OpenAI, Anthropic, Google, Groq, DeepSeek, etc.)
- Tokens (GitHub, GitLab, HuggingFace, PyPI, NPM)
- Connection strings (PostgreSQL, MySQL, MongoDB, Redis)
- Private keys (RSA, EC, OpenSSH)
- Local paths (`/Volumes/`, `/Users/`, `/home/`)
- JWT tokens
- Cloud credentials (AWS, Azure, Cloudflare)

### Pre-Push Hook (scan_secrets.sh)

**When:** Every time you run `git push`

**What it does:**
1. Scans entire repository for secrets
2. Generates `SECURITY_REPORT.md` with findings
3. Blocks push if secrets detected (you must review and fix)
4. Warns about legacy RSA keys (FIPS 204 compliance)

**Output:**
```bash
$ git push
ğŸ”’ Scanning for secrets...
âš ï¸  3 potential secrets detected. See SECURITY_REPORT.md
Push blocked. Review and fix before pushing.
```

## OWASP Agentic Security Compliance

| ID | Risk | Mitigation |
|----|------|------------|
| **ASI04** | Information Disclosure (Secrets) | `sanitize.py` auto-replaces secrets; `scan_secrets.sh` blocks pushes |
| **ASI06** | Legacy Cryptography | `scan_secrets.sh` warns about RSA keys; migrate to ML-DSA per FIPS 204 |
| **ASI01** | Excessive Agency | Hooks prevent automated commits of sensitive data |
| **ASI02** | Overreliance | Human review required for SECURITY_REPORT.md findings |

## Secret Patterns Detected

### AI/LLM Providers (2026)
| Pattern | Example | Placeholder |
|---------|---------|-------------|
| OpenAI | `sk-abc123...` | `YOUR_OPENAI_API_KEY_HERE` |
| Anthropic | `sk-ant-api03-...` | `YOUR_ANTHROPIC_API_KEY_HERE` |
| OpenRouter | `sk-or-v1-...` | `YOUR_OPENROUTER_API_KEY_HERE` |
| Groq | `gsk_abc123...` | `YOUR_GROQ_API_KEY_HERE` |
| DeepSeek | `sk-abc123...` | `YOUR_DEEPSEEK_API_KEY_HERE` |
| Google/Gemini | `AIzaSyA...` | `YOUR_GOOGLE_API_KEY_HERE` |
| Tavily | `tvly-abc123...` | `YOUR_TAVILY_API_KEY_HERE` |
| Perplexity | `pplx-abc123...` | `YOUR_PERPLEXITY_API_KEY_HERE` |
| Cohere | `co-abc123...` | `YOUR_COHERE_API_KEY_HERE` |
| XAI | `xai-abc123...` | `YOUR_XAI_API_KEY_HERE` |

### Version Control
| Pattern | Example | Placeholder |
|---------|---------|-------------|
| GitHub Token | `ghp_abc123...` | `YOUR_GITHUB_TOKEN_HERE` |
| GitLab Token | `glpat-abc123...` | `YOUR_GITLAB_TOKEN_HERE` |
| GitHub PAT | `github_pat_xxx...` | `YOUR_GITHUB_TOKEN_HERE` |

### Cloud Providers
| Pattern | Example | Placeholder |
|---------|---------|-------------|
| AWS Access Key | `AKIAIOSFODNN7EXAMPLE` | `YOUR_AWS_ACCESS_KEY_ID_HERE` |
| AWS Secret | `wJalrXUtnFEMI/K7MDENG...` | `YOUR_AWS_SECRET_KEY_HERE` |
| Azure Storage | `Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ...==` | `YOUR_AZURE_STORAGE_KEY_HERE` |
| Cloudflare | `CF_API_KEY=...` | `YOUR_CLOUDFLARE_API_KEY_HERE` |

### Database Connections
| Pattern | Example | Placeholder |
|---------|---------|-------------|
| PostgreSQL | `postgresql://user:pass@host...` | Detected and flagged |
| MySQL | `mysql://user:pass@host...` | Detected and flagged |
| MongoDB | `mongodb+srv://user:pass@host...` | Detected and flagged |
| Redis | `redis://user:pass@host...` | Detected and flagged |

### Private Keys
| Type | Detection | Action |
|------|-----------|--------|
| RSA | `-----BEGIN RSA PRIVATE KEY-----` | Warning (FIPS 204 migration) |
| EC | `-----BEGIN EC PRIVATE KEY-----` | Detected and flagged |
| OpenSSH | `-----BEGIN OPENSSH PRIVATE KEY-----` | Detected and flagged |
| Generic | `-----BEGIN PRIVATE KEY-----` | Detected and flagged |

### Local Paths (ASI04)
| Pattern | Example | Sanitized To |
|---------|---------|--------------|
| macOS Volumes | `/Volumes/Sandisk/code/...` | `/path/to/your/project` |
| macOS Users | `/Users/username/...` | `/path/to/your/project` |
| Linux Home | `/home/username/...` | `/path/to/your/project` |

## Manual Security Commands

```bash
# Run sanitizer on specific file
python .ainish/scripts/sanitize.py --file src/vrlmrag.py

# Run sanitizer on all files (dry-run)
python .ainish/scripts/sanitize.py --dry-run

# Run secret scanner manually
bash .ainish/scripts/scan_secrets.sh

# View security report
cat SECURITY_REPORT.md
```

## Best Practices

### 1. Never Commit API Keys

**âŒ Wrong:**
```python
# In your code
client = OpenAI(api_key="sk-abc123...")
```

**âœ… Correct:**
```python
# In your code
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

# In .env (gitignored)
OPENAI_API_KEY=sk-abc123...
```

### 2. Use .env for Local Secrets

Create `.env` in project root (already gitignored):
```bash
# .env â€” local secrets, never commit
SAMBANOVA_API_KEY=your_key_here
NEBIUS_API_KEY=your_key_here
OPENAI_API_KEY=your_key_here
```

### 3. Review SECURITY_REPORT.md

Before every push, review the generated report:
```bash
cat SECURITY_REPORT.md
```

If secrets are detected:
1. Remove the secret from the file
2. Use environment variables instead
3. Commit the fix
4. Push again

### 4. Handle False Positives

If `scan_secrets.sh` flags a non-secret (e.g., a hash that looks like a key):

1. Verify it's not actually a secret
2. Add exclusion pattern to `.ainish/scripts/scan_secrets.sh`
3. Or use inline ignore comment: `# ainish-ignore: pattern-name`

## Security Checklist for Contributors

Before submitting a PR:

- [ ] Run `bash .ainish/scripts/scan_secrets.sh` â€” no secrets detected
- [ ] Review `SECURITY_REPORT.md` â€” all findings are false positives or fixed
- [ ] No API keys in source code â€” all use `os.getenv()`
- [ ] No local paths in examples â€” use `/path/to/your/...` placeholders
- [ ] `.env` is gitignored and contains your real keys
- [ ] No private keys committed â€” use environment or secure vault

## Re-deploying Security

If hooks are accidentally removed or you want to update:

```bash
# Re-run the security deployment
ainish-coder --local-security
```

This will:
- Re-install pre-commit and pre-push hooks
- Update scripts to latest patterns
- Preserve any custom exclusions you've added

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Developer Workflow                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Edit files â†’ Stage (git add) â†’ Commit â†’ Push               â”‚
â”‚                    â†“              â†“                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚ pre-commit  â”‚    â”‚  pre-push   â”‚                  â”‚
â”‚         â”‚   hook      â”‚    â”‚    hook     â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                â†“                  â†“                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚ sanitize.py â”‚    â”‚scan_secrets.â”‚                  â”‚
â”‚         â”‚             â”‚    â”‚    sh       â”‚                  â”‚
â”‚         â”‚ â€¢ Auto-fix  â”‚    â”‚ â€¢ Full scan â”‚                  â”‚
â”‚         â”‚   secrets   â”‚    â”‚ â€¢ Generate  â”‚                  â”‚
â”‚         â”‚ â€¢ Sanitize  â”‚    â”‚   report    â”‚                  â”‚
â”‚         â”‚   paths     â”‚    â”‚ â€¢ Block if  â”‚                  â”‚
â”‚         â”‚             â”‚    â”‚   secrets   â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Reporting Security Issues

If you discover a security vulnerability:

1. **DO NOT** open a public issue
2. Email security report to: security@yourproject.org
3. Include reproduction steps and impact assessment
4. Allow 48 hours for response before public disclosure

## Compliance Notes

- **FIPS 204 (2026):** Project recommends ML-DSA for post-quantum signatures. RSA keys detected by scanner trigger warnings for migration planning.
- **OWASP Top 10:** Addressed via local hooks and automated sanitization
- **Zero Trust:** All commits scanned; no assumption of trust based on developer
- **Least Privilege:** Hooks only modify staged files, not working directory

## Resources

- [OWASP Agentic Security Top 10 (2026)](https://owasp.org/www-project-agentic-security/)
- [FIPS 204 â€” Module-Lattice-Based Digital Signature Standard](https://csrc.nist.gov/pubs/fips/204/final)
- [Git Hooks Documentation](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)
- [ainish-coder Documentation](https://github.com/ainish-coder/ainish-coder)

---

**Last updated:** 2026-02-08  
**Security version:** 1.0.0  
**Compliance:** OWASP Agentic Security 2026, FIPS 204
